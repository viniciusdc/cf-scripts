
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>GitHub Actions Infrastructure &#8212; cf-scripts  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Usage Docs" href="usage.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="github-actions-infrastructure">
<h1>GitHub Actions Infrastructure<a class="headerlink" href="#github-actions-infrastructure" title="Permalink to this headline">¶</a></h1>
<p>The regro-cf-autotick-bot relies on GitHub Actions to enable the automatic
merging of its PRs. In the future, other key functionalities currently
performed by the bot may be moved to GitHub Actions as well.</p>
<div class="section" id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p>This service is structured as follows.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">action.yml</span></code> file, Docker image, and code that runs the bot are stored
in the <a class="reference external" href="https://github.com/regro/cf-autotick-bot-action">cf-autotick-bot-action</a> repo.</p></li>
<li><p>The GitHub Action always runs using the <code class="docutils literal notranslate"><span class="pre">prod</span></code> tag of the <code class="docutils literal notranslate"><span class="pre">condaforge/rego-cf-autotick-bot-action</span></code>
Docker container built from the repo. This container is set in the <code class="docutils literal notranslate"><span class="pre">action.yml</span></code> file.</p></li>
<li><p>Feedstocks always use the <code class="docutils literal notranslate"><span class="pre">action.yml</span></code> file on the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of the
<code class="docutils literal notranslate"><span class="pre">regro/cf-autotick-bot-action</span></code> repo. This configuration is set in <code class="docutils literal notranslate"><span class="pre">conda-smithy</span></code>.
A migration of all feedstocks would be required to change it.</p></li>
<li><p>The GitHub events that trigger the action are also set in <code class="docutils literal notranslate"><span class="pre">conda-smithy</span></code>.</p></li>
</ul>
<div class="section" id="updating-and-deploying-the-action">
<h3>Updating and Deploying the Action<a class="headerlink" href="#updating-and-deploying-the-action" title="Permalink to this headline">¶</a></h3>
<p>You can push updates to any of the code in the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of the
<code class="docutils literal notranslate"><span class="pre">regro/cf-autotick-bot-action</span></code> repo <strong>except the action.yml file</strong>. This
file is used globally by conda-forge and so changes to it should be considered
carefully. Once you have updated the code, you need to rebuild the Docker container.
Finally, tag your container as <code class="docutils literal notranslate"><span class="pre">condaforge/rego-cf-autotick-bot-action:prod</span></code> and push
it DockerHub. All GitHub Actions use this tag and so will see the updated code
as soon as the container is available.</p>
</div>
<div class="section" id="turning-it-all-off">
<h3>Turning It All Off<a class="headerlink" href="#turning-it-all-off" title="Permalink to this headline">¶</a></h3>
<p>To turn off the GitHub Actions for all of <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code>, simply delete the
<code class="docutils literal notranslate"><span class="pre">condaforge/rego-cf-autotick-bot-action:prod</span></code> container from DockerHub. This
will cause all of the actions on feedstocks that run with it to fail.</p>
</div>
</div>
<div class="section" id="automerging-prs">
<h2>Automerging PRs<a class="headerlink" href="#automerging-prs" title="Permalink to this headline">¶</a></h2>
<p>PRs from the regro-cf-autotick-bot are automatically merged when all of the
following conditions are met</p>
<ol class="arabic simple">
<li><p>all PR statuses must be passing, there must be at least one passing status, except maybe the linter
(which is not fully reliable due to various bugs that need fixing)</p></li>
<li><p>the PR must be from the regro-cf-autotick-bot user</p></li>
<li><p>the feedstock must have <code class="docutils literal notranslate"><span class="pre">bot:</span> <span class="pre">automerge:</span> <span class="pre">True</span></code> set in the <code class="docutils literal notranslate"><span class="pre">conda-forge.yml</span></code>
If no key is set at all, it currently defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code> but this may change.</p></li>
<li><p>the PR must have <code class="docutils literal notranslate"><span class="pre">[bot-automerge]</span></code> set in the title</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">condaforge/rego-cf-autotick-bot-action:prod</span></code> Docker image must exist
on DockerHub</p></li>
</ol>
<div class="section" id="opting-out-of-automerge">
<h3>Opting Out of Automerge<a class="headerlink" href="#opting-out-of-automerge" title="Permalink to this headline">¶</a></h3>
<p>Any feedstock can be opted-out of automerge by adding the following lines to
its <code class="docutils literal notranslate"><span class="pre">conda-forge.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">bot</span><span class="p">:</span>
  <span class="nt">automerge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>Currently, if these keys do not exist, the default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. This default
may change at some future date.</p>
</div>
<div class="section" id="turning-on-or-off-automerge-for-a-specific-pr">
<h3>Turning On or Off Automerge for a Specific PR<a class="headerlink" href="#turning-on-or-off-automerge-for-a-specific-pr" title="Permalink to this headline">¶</a></h3>
<p>To turn off automerge for a specific PR from the regro-cf-autotick-bot, simply
delete the <code class="docutils literal notranslate"><span class="pre">[bot-automerge]</span></code> slug from the PR title. Similarly, adding this
slug to the title of a PR from the regro-cf-autotick-bot will cause it to be
automatically merged when the conditions above are met.</p>
</div>
</div>
<div class="section" id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline">¶</a></h2>
<p>A small <code class="docutils literal notranslate"><span class="pre">flask</span></code> app running on <code class="docutils literal notranslate"><span class="pre">heroku</span></code> counts the number of completed
GitHub Actions across <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code>. The code for this app lives in the
<a class="reference external" href="https://github.com/conda-forge/conda-forge-status-monitor">conda-forge-status-monitor</a> repo. This app
serves a <a class="reference external" href="https://conda-forge-status-monitor.herokuapp.com/">report</a> whose data is
displayed on the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> <a class="reference external" href="https://conda-forge.org/status/">status webpage</a>.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">cf-scripts</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="migrators.html">Making Migrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrators.html#building-a-migration-yaml-using-cfep9">Building a Migration YAML Using CFEP9</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrators.html#building-a-migration">Building a Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Docs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GitHub Actions Infrastructure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#design">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automerging-prs">Automerging PRs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitoring">Monitoring</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="usage.html" title="previous chapter">Usage Docs</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Conda-forge-tick Development Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/github_actions_infrastructure.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>